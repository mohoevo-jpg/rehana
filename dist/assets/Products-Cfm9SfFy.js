import{I as _,J as z,g as b,h as H,r as d,c as m,b as t,j as c,G as k,k as l,t as u,F as I,m as W,A as S,o as p,e as i,v as n,H as E,K as G}from"./index-DUS2SrFg.js";import{f}from"./currency-DPHm-HqN.js";import{A as M}from"./AppModal-BPy9MgH5.js";import{R as K}from"./ReportPreviewModal-DkvWyncV.js";import{J as Q}from"./JsBarcode-Bw_ynkXT.js";import{P as V}from"./printer-CBd1wSWY.js";import{P as q}from"./plus-T6ifTBuq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-Dlap17QE.js";const O={class:"space-y-6"},X={class:"flex justify-between items-center"},Y={class:"flex gap-2"},Z={class:"bg-white shadow rounded-lg overflow-hidden"},ee={key:0,class:"p-6 text-center text-gray-500"},te={key:1,class:"p-6 text-center text-red-500"},se={key:2,class:"min-w-full divide-y divide-gray-200"},oe={class:"bg-white divide-y divide-gray-200"},re={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},de={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ue={class:"px-6 py-4 whitespace-nowrap text-sm font-medium flex gap-2"},me=["onClick"],ce=["onClick"],pe=["onClick"],ge={class:"space-y-4"},xe={class:"grid grid-cols-3 gap-4"},ye={class:"grid grid-cols-2 gap-4"},ve={class:"flex items-center gap-2"},be={class:"flex gap-2"},fe={class:"flex flex-col items-center justify-center p-4 space-y-4"},we={class:"bg-white p-4 border rounded shadow-sm"},Be={__name:"Products",setup(he){const a=_(),A=z(),w=b(()=>a.getAllProducts);H(()=>{a.fetchProducts()});const g=d(!1),x=d(!1),h=d(!1),y=d(null),v=d(null),U=b(()=>`تاريخ الطباعة: ${new Date().toLocaleDateString("ar-IQ")}`),$=[{key:"name",label:"المنتج",class:"text-right"},{key:"category",label:"القسم",class:"text-center"},{key:"price",label:"السعر",class:"text-left"},{key:"stock",label:"المخزون",class:"text-center"}],B=b(()=>w.value.map(s=>({name:s.name,category:s.category,price:f(s.price),stock:s.stock}))),D=b(()=>({name:"العدد الكلي",category:w.value.length+" منتج"})),T=()=>{h.value=!0},r=d({name:"",price:0,costPrice:0,stock:0,category:"",barcode:"",discountPrice:0,isAvailable:!0,image:""}),P=(s=null)=>{v.value=s,s?r.value={...s,discountPrice:s.discountPrice||0,isAvailable:s.isAvailable!==!1,image:s.images&&s.images.length>0?s.images[0]:s.image||""}:r.value={name:"",price:0,costPrice:0,stock:0,category:"",barcode:"",discountPrice:0,isAvailable:!0,image:""},g.value=!0},j=()=>{const s={...r.value};s.image?s.images=[s.image]:s.images=[],v.value?a.updateProduct({...s,id:v.value.id}):(s.barcode||(s.barcode=Math.floor(Math.random()*1e12).toString()),a.addProduct(s)),g.value=!1},F=s=>{confirm("هل أنت متأكد من الحذف؟")&&a.deleteProduct(s)},R=()=>{r.value.barcode=Math.floor(Math.random()*1e12).toString()},J=d(null),L=async s=>{if(!s.barcode){alert("لا يوجد باركود لهذا المنتج");return}J.value=s,x.value=!0,await G();const e=A;try{Q(y.value,s.barcode,{format:e.barcodeFormat,displayValue:e.barcodeShowText,text:e.barcodeShowText?s.name+" - "+f(s.price):void 0,width:e.barcodeWidth,height:e.barcodeHeight,fontSize:e.barcodeFontSize,margin:e.barcodeMargin})}catch(o){console.error(o),alert("حدث خطأ أثناء عرض الباركود")}},N=()=>{if(y.value)try{const s=y.value.toDataURL(),e=window.open("","","height=400,width=600");e.document.write("<html><head><title>Print Barcode</title>"),e.document.write("<style>body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }</style>"),e.document.write("</head><body>"),e.document.write(`<img src="${s}" />`),e.document.write("</body></html>"),e.document.close(),e.onload=()=>{e.focus(),e.print(),e.close(),x.value=!1}}catch(s){console.error(s),alert("حدث خطأ أثناء الطباعة")}};return(s,e)=>(p(),m("div",O,[t("div",X,[e[17]||(e[17]=t("h2",{class:"text-2xl font-bold text-gray-900"},"إدارة المنتجات",-1)),t("div",Y,[t("button",{onClick:e[0]||(e[0]=o=>T()),class:"bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center gap-2"},[c(l(V),{class:"w-5 h-5"}),e[15]||(e[15]=k(" طباعة تقرير ",-1))]),t("button",{onClick:e[1]||(e[1]=o=>P()),class:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 flex items-center gap-2"},[c(l(q),{class:"w-5 h-5"}),e[16]||(e[16]=k(" إضافة منتج ",-1))])])]),t("div",Z,[l(a).loading?(p(),m("div",ee," جاري التحميل... ")):l(a).error?(p(),m("div",te,[k(" حدث خطأ: "+u(l(a).error)+" ",1),t("button",{onClick:e[2]||(e[2]=o=>l(a).fetchProducts()),class:"mr-2 text-indigo-600 underline"},"إعادة المحاولة")])):(p(),m("table",se,[e[18]||(e[18]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"الاسم"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"القسم"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"سعر الشراء"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"سعر البيع"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"المخزون"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"الباركود"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"إجراءات")])],-1)),t("tbody",oe,[(p(!0),m(I,null,W(w.value,o=>(p(),m("tr",{key:o.id},[t("td",re,u(o.name),1),t("td",ae,u(o.category),1),t("td",le,u(l(f)(o.costPrice||0)),1),t("td",ie,u(l(f)(o.price)),1),t("td",ne,u(o.stock),1),t("td",de,u(o.barcode),1),t("td",ue,[t("button",{onClick:C=>L(o),class:"text-gray-600 hover:text-gray-900",title:"طباعة باركود"},[c(l(V),{class:"w-5 h-5"})],8,me),t("button",{onClick:C=>P(o),class:"text-indigo-600 hover:text-indigo-900"},"تعديل",8,ce),t("button",{onClick:C=>F(o.id),class:"text-red-600 hover:text-red-900"},"حذف",8,pe)])]))),128))])]))]),c(M,{show:g.value,title:v.value?"تعديل منتج":"إضافة منتج جديد",onClose:e[12]||(e[12]=o=>g.value=!1),onConfirm:j},{default:S(()=>[t("div",ge,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"اسم المنتج",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.name=o),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[n,r.value.name]])]),t("div",xe,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700"},"سعر الشراء",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.costPrice=o),type:"number",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[n,r.value.costPrice,void 0,{number:!0}]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700"},"سعر البيع",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.value.price=o),type:"number",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[n,r.value.price,void 0,{number:!0}]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700"},"سعر الخصم",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.value.discountPrice=o),type:"number",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",placeholder:"اختياري"},null,512),[[n,r.value.discountPrice,void 0,{number:!0}]])])]),t("div",ye,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700"},"الكمية",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.value.stock=o),type:"number",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[n,r.value.stock,void 0,{number:!0}]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700"},"القسم",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>r.value.category=o),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[n,r.value.category]])])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700"},"رابط الصورة",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>r.value.image=o),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",placeholder:"https://..."},null,512),[[n,r.value.image]])]),t("div",ve,[i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>r.value.isAvailable=o),type:"checkbox",id:"isAvailable",class:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"},null,512),[[E,r.value.isAvailable]]),e[26]||(e[26]=t("label",{for:"isAvailable",class:"text-sm font-medium text-gray-700"},"متاح للبيع",-1))]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"الباركود",-1)),t("div",be,[i(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>r.value.barcode=o),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[n,r.value.barcode]]),t("button",{onClick:R,type:"button",class:"mt-1 px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 border border-gray-300"}," توليد ")])])])]),_:1},8,["show","title"]),c(M,{show:x.value,title:"معاينة الباركود",confirmText:"طباعة",cancelText:"إغلاق",onClose:e[13]||(e[13]=o=>x.value=!1),onConfirm:N},{default:S(()=>[t("div",fe,[t("div",we,[t("canvas",{ref_key:"previewCanvas",ref:y},null,512)]),e[28]||(e[28]=t("p",{class:"text-sm text-gray-500"},"سيتم طباعة الباركود بالشكل الظاهر أعلاه",-1))])]),_:1},8,["show"]),c(K,{show:h.value,title:"تقرير المنتجات",data:B.value,columns:$,summary:D.value,subtitle:U.value,onClose:e[14]||(e[14]=o=>h.value=!1)},null,8,["show","data","summary","subtitle"])]))}};export{Be as default};
