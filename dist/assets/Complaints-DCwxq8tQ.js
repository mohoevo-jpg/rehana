import{u as F,r as g,h as N,g as b,c as a,b as s,j as x,n as v,t as n,F as w,m as k,A as R,Q as C,o as r,d as p,G as m,k as h,e as S,v as T}from"./index-DUS2SrFg.js";import{A as B}from"./AppModal-BPy9MgH5.js";import{M as $}from"./message-circle-Db_nYIl_.js";import{c as U}from"./createLucideIcon-Dlap17QE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license lucide-vue-next v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=U("MailIcon",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Q={class:"space-y-6"},W={class:"bg-white shadow rounded-lg p-2"},z={class:"flex space-x-2 space-x-reverse border-b"},E={class:"p-4"},G={key:0,class:"text-center py-10 text-gray-500"},q={key:1,class:"space-y-4"},H={class:"flex justify-between items-start mb-2"},J={class:"font-bold text-lg text-gray-900"},K={class:"text-sm text-gray-500 flex items-center gap-2"},P={class:"font-bold"},X={key:0,class:"bg-gray-200 px-2 rounded text-xs"},Y={key:1,class:"bg-gray-200 px-2 rounded text-xs"},Z={class:"text-xs text-gray-400"},ee={class:"text-gray-700 whitespace-pre-line mb-4"},te={key:0,class:"border-t pt-3 mt-3 space-y-2"},se={class:"text-xs font-bold text-primary-600 mb-1"},oe={class:"text-sm"},ae={class:"flex gap-2 mt-4 border-t pt-3"},re=["onClick"],ne=["href"],le=["href"],ie={class:"space-y-4"},de={class:"flex justify-end gap-2"},be={__name:"Complaints",setup(pe){const M=F(),i=g("complaint"),d=g([]),c=g(!1),y=g(null),u=g(""),f=async()=>{try{const o=await C.get("/complaints");d.value=o.data}catch(o){console.error("Failed to fetch complaints",o)}};N(()=>{f(),setInterval(f,3e4)});const _=b(()=>d.value.filter(o=>o.type===i.value).reverse()),j=b(()=>d.value.filter(o=>o.type==="complaint").length),I=b(()=>d.value.filter(o=>o.type==="suggestion").length),A=o=>{y.value=o,u.value="",c.value=!0},L=async()=>{var o;if(u.value.trim())try{const e=(await C.post(`/complaints/${y.value.id}/reply`,{message:u.value,by:((o=M.currentUser)==null?void 0:o.name)||"Admin"})).data,l=d.value.findIndex(D=>D.id===y.value.id);l!==-1&&(d.value[l]=e.complaint),c.value=!1}catch{alert("Failed to send reply")}},V=o=>{let t=o.phone.replace(/\D/g,"");t.startsWith("07")&&(t="964"+t.substring(1));const e=encodeURIComponent(`مرحباً ${o.name}، بخصوص رسالتك حول "${o.subject}"...`);return`https://wa.me/${t}?text=${e}`};return(o,t)=>(r(),a("div",Q,[t[9]||(t[9]=s("div",{class:"flex justify-between items-center"},[s("h1",{class:"text-2xl font-bold text-gray-900"},"الشكاوي والمقترحات")],-1)),s("div",W,[s("div",z,[s("button",{onClick:t[0]||(t[0]=e=>i.value="complaint"),class:v(["px-4 py-2 font-medium transition-colors border-b-2",i.value==="complaint"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"])}," الشكاوي ("+n(j.value)+") ",3),s("button",{onClick:t[1]||(t[1]=e=>i.value="suggestion"),class:v(["px-4 py-2 font-medium transition-colors border-b-2",i.value==="suggestion"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"])}," المقترحات ("+n(I.value)+") ",3)]),s("div",E,[_.value.length===0?(r(),a("div",G," لا توجد "+n(i.value==="complaint"?"شكاوي":"مقترحات")+" حالياً ",1)):(r(),a("div",q,[(r(!0),a(w,null,k(_.value,e=>(r(),a("div",{key:e.id,class:"border rounded-xl p-4 hover:shadow-md transition-shadow bg-gray-50"},[s("div",H,[s("div",null,[s("h3",J,n(e.subject),1),s("div",K,[s("span",P,n(e.name),1),e.phone?(r(),a("span",X,n(e.phone),1)):p("",!0),e.email?(r(),a("span",Y,n(e.email),1)):p("",!0),s("span",Z," • "+n(new Date(e.createdAt).toLocaleString("ar-IQ")),1)])]),s("span",{class:v(["px-2 py-1 rounded text-xs font-bold",e.status==="replied"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"])},n(e.status==="replied"?"تم الرد":"قيد الانتظار"),3)]),s("p",ee,n(e.message),1),e.replies&&e.replies.length>0?(r(),a("div",te,[(r(!0),a(w,null,k(e.replies,l=>(r(),a("div",{key:l.id,class:"bg-white p-3 rounded-lg border"},[s("p",se,"رد الإدارة ("+n(l.by)+")",1),s("p",oe,n(l.message),1)]))),128))])):p("",!0),s("div",ae,[e.userId!=="guest"?(r(),a("button",{key:0,onClick:l=>A(e),class:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 text-sm font-bold"},[x(h($),{class:"w-4 h-4"}),t[5]||(t[5]=m(" رد داخل التطبيق ",-1))],8,re)):p("",!0),e.phone?(r(),a("a",{key:1,href:V(e),target:"_blank",class:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm font-bold"},[x(h($),{class:"w-4 h-4"}),t[6]||(t[6]=m(" رد عبر واتساب ",-1))],8,ne)):p("",!0),e.email?(r(),a("a",{key:2,href:`mailto:${e.email}?subject=رد على: ${e.subject}`,class:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm font-bold"},[x(h(O),{class:"w-4 h-4"}),t[7]||(t[7]=m(" رد عبر البريد ",-1))],8,le)):p("",!0)])]))),128))]))])]),x(B,{isOpen:c.value,onClose:t[4]||(t[4]=e=>c.value=!1),title:"الرد على الشكوى"},{default:R(()=>[s("div",ie,[s("div",null,[t[8]||(t[8]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"الرد",-1)),S(s("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),rows:"4",class:"w-full border rounded-lg p-2 focus:ring-2 focus:ring-primary-500 outline-none"},null,512),[[T,u.value]])]),s("div",de,[s("button",{onClick:t[3]||(t[3]=e=>c.value=!1),class:"px-4 py-2 border rounded-lg hover:bg-gray-50"},"إلغاء"),s("button",{onClick:L,class:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700"},"إرسال")])])]),_:1},8,["isOpen"])]))}};export{be as default};
