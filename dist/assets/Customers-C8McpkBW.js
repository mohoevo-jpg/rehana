import{B as et,J as st,r as d,c,b as t,d as q,j as _,t as l,G as ot,k as b,F as E,m as W,e as h,v as g,A as R,o as p,n as G}from"./index-DUS2SrFg.js";import{u as at}from"./customers-D2qX1kpu.js";import{f as y}from"./currency-DPHm-HqN.js";import{f as H}from"./date-CbKvo9xS.js";import{R as lt}from"./ReportPreviewModal-DkvWyncV.js";import{P as nt}from"./plus-T6ifTBuq.js";import{D as it}from"./dollar-sign-CyseO_Ry.js";import{F as rt}from"./file-text-C5kbrT4y.js";import{P as dt}from"./pen-square-BZijlLpx.js";import{T as mt}from"./trash-2-DjMAfoaB.js";import"./format-MhD4UfPn.js";import"./en-US-dIBtKp69.js";import"./ar-YW_Uz9wj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-Dlap17QE.js";const ut={class:"space-y-6"},ct={class:"flex justify-between items-center"},pt={class:"text-2xl font-bold text-gray-900"},yt={class:"bg-white shadow overflow-hidden sm:rounded-lg"},xt={class:"min-w-full divide-y divide-gray-200"},bt={class:"bg-gray-50"},ht={scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},gt={scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},vt={scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},ft={scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},wt={class:"bg-white divide-y divide-gray-200"},_t={class:"px-6 py-4 whitespace-nowrap"},kt={class:"text-sm font-medium text-gray-900"},$t={class:"text-xs text-gray-500"},Ct={class:"px-6 py-4 whitespace-nowrap"},Pt={class:"text-sm text-gray-500"},St={class:"px-6 py-4 whitespace-nowrap"},zt={class:"text-sm text-gray-500"},jt={class:"px-6 py-4 whitespace-nowrap"},It={class:"text-sm text-gray-500 truncate max-w-xs"},Tt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex gap-2 justify-end"},Dt=["onClick"],Vt=["onClick"],Mt=["onClick"],Ft=["onClick"],Rt={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Ut={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Nt={class:"inline-block align-bottom bg-white rounded-lg text-right overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Bt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Lt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},At={class:"mt-4 space-y-4"},qt={class:"block text-sm font-medium text-gray-700"},Et={class:"block text-sm font-medium text-gray-700"},Wt={class:"block text-sm font-medium text-gray-700"},Gt={class:"block text-sm font-medium text-gray-700"},Ht={class:"block text-sm font-medium text-gray-700"},Jt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Kt={key:1,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Ot={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Qt={class:"inline-block align-bottom bg-white rounded-lg text-right overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Xt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Yt={class:"mt-4 space-y-4"},Zt={class:"relative mt-1"},te={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ee={key:0,class:"text-sm text-gray-600 italic"},se={key:1,class:"text-sm"},ve={__name:"Customers",setup(oe){const k=at(),j=et(),J=st(),I=d(!1),T=d(!1),D=d(!1),V=d([]),K=d([{key:"date",label:"التاريخ"},{key:"id",label:"رقم الفاتورة"},{key:"type",label:"النوع"},{key:"items",label:"التفاصيل"},{key:"total",label:"المبلغ"}]),U=d({}),N=d(null),B=d(""),L=d(""),P=d(!1),i=d({id:null,name:"",phone:"",email:"",address:"",notes:""}),m=d({customerId:null,amount:0,notes:""}),A=(o=null)=>{o?(P.value=!0,i.value={...o}):(P.value=!1,i.value={id:null,name:"",phone:"",email:"",address:"",notes:""}),I.value=!0},O=o=>{m.value={customerId:o.id,amount:0,notes:""},T.value=!0},M=()=>{T.value=!1},Q=()=>{var e;if(m.value.amount<=0)return;const o={id:Date.now(),items:[],subtotal:-m.value.amount,discount:0,total:-m.value.amount,payment:{method:"cash"},date:new Date,userId:null,branchId:null,customerId:m.value.customerId,customerName:(e=k.getCustomerById(m.value.customerId))==null?void 0:e.name,isPayment:!0,notes:m.value.notes};j.addSale(o),M()},F=()=>{I.value=!1},X=()=>{P.value?k.updateCustomer(i.value):k.addCustomer(i.value),F()},Y=o=>{confirm("هل أنت متأكد من حذف هذا العميل؟")&&k.deleteCustomer(o)},Z=o=>{N.value=o;const e=j.sales.filter(a=>a.customerId===o.id),s=e.filter(a=>!a.isPayment).reduce((a,u)=>a+u.total,0),r=e.filter(a=>a.payment.method==="credit").reduce((a,u)=>a+u.total,0),x=e.filter(a=>a.isPayment).reduce((a,u)=>a+Math.abs(u.total),0),$=r-x;B.value=`كشف حساب عميل: ${o.name}`,L.value=`الهاتف: ${o.phone} | العنوان: ${o.address||"-"}`,V.value=e.map(a=>{const u=a.payment.method==="credit",v=a.isPayment;let S=v?"تسديد دفعة":u?"آجل":"نقدي",f="";return v?f=a.notes||"تسديد نقدي":f=a.items.map(z=>`${z.name} (${z.quantity})`).join("، "),{date:H(a.date),id:`#${a.id}`,type:S,typeLabel:S,items:f,itemsText:f,rawItems:a.items||[],total:y(a.total),totalAmount:a.total,isPayment:v,isCredit:u}}),U.value={date:"",id:"",type:"",items:`مشتريات: ${y(s)} | مسدد: ${y(x)} | ديون: ${y(r)}`,total:y($)},D.value=!0},tt=()=>{const o=N.value;if(!o)return;const e=J,s=e.invoicePaperSize||"80mm",r=(e.invoiceFontSize||12)+"px",x=e.invoiceFontSize||12,$=j.sales.filter(n=>n.customerId===o.id),a=$.filter(n=>!n.isPayment).reduce((n,C)=>n+C.total,0),u=$.filter(n=>n.payment.method==="credit").reduce((n,C)=>n+C.total,0),v=$.filter(n=>n.isPayment).reduce((n,C)=>n+Math.abs(C.total),0),S=u-v,f=V.value.map(n=>`
    <tr>
      <td style="border-bottom: 1px dashed #eee; padding: 4px 0;">${n.date}</td>
      <td style="border-bottom: 1px dashed #eee; padding: 4px 0;">${n.typeLabel}</td>
      <td style="border-bottom: 1px dashed #eee; padding: 4px 0; font-weight: bold; direction: ltr;">${n.total}</td>
    </tr>
  `).join(""),z=`
    <html>
      <head>
        <title>كشف حساب - ${o.name}</title>
        <style>
          body { font-family: 'Arial', sans-serif; direction: rtl; padding: 5px; width: ${s}; margin: 0 auto; font-size: ${r}; }
          .header { text-align: center; margin-bottom: 10px; border-bottom: 1px solid #000; padding-bottom: 10px; }
          .header h2 { margin: 0; font-size: ${x+2}px; }
          .customer-info { margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 5px; }
          table { width: 100%; border-collapse: collapse; font-size: ${r}; }
          th { text-align: right; border-bottom: 1px solid #000; padding: 5px 0; }
          .summary { margin-top: 15px; border-top: 2px solid #000; padding-top: 10px; }
          .summary-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
          .footer { margin-top: 20px; text-align: center; font-size: ${r}; }
        </style>
      </head>
      <body>
        <div class="header">
          <h2>${e.shopName}</h2>
          <p>${e.phone}</p>
          <h3>كشف حساب عميل</h3>
        </div>
        
        <div class="customer-info">
          <div><strong>العميل:</strong> ${o.name}</div>
          <div><strong>الهاتف:</strong> ${o.phone}</div>
          <div><strong>التاريخ:</strong> ${H(new Date)}</div>
        </div>

        <table>
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>العملية</th>
              <th>المبلغ</th>
            </tr>
          </thead>
          <tbody>
            ${f}
          </tbody>
        </table>

        <div class="summary">
          <div class="summary-row">
            <span>مجموع المشتريات:</span>
            <span>${y(a)}</span>
          </div>
          <div class="summary-row">
            <span>مجموع المسدد:</span>
            <span>${y(v)}</span>
          </div>
          <div class="summary-row" style="font-weight: bold; font-size: ${x+2}px;">
            <span>الرصيد الحالي (دين):</span>
            <span>${y(S)}</span>
          </div>
        </div>

        <div class="footer">
          <p>${e.reportFooterText||"شكرا لتعاملكم معنا"}</p>
        </div>
      </body>
    </html>
  `,w=window.open("","","height=600,width=400");w.document.write(z),w.document.close(),w.onload=()=>{w.focus(),w.print(),w.close()}};return(o,e)=>(p(),c("div",ut,[t("div",ct,[t("h2",pt,l(o.$t("menu.customers")),1),t("button",{onClick:e[0]||(e[0]=s=>A()),class:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 flex items-center gap-2"},[_(b(nt),{class:"w-5 h-5"}),ot(" "+l(o.$t("customers.add_customer")),1)])]),t("div",yt,[t("table",xt,[t("thead",bt,[t("tr",null,[t("th",ht,l(o.$t("customers.name")),1),t("th",gt,l(o.$t("customers.phone")),1),t("th",vt,l(o.$t("customers.address")),1),t("th",ft,l(o.$t("customers.notes")),1),e[9]||(e[9]=t("th",{scope:"col",class:"relative px-6 py-3"},[t("span",{class:"sr-only"},"إجراءات")],-1))])]),t("tbody",wt,[(p(!0),c(E,null,W(b(k).customers,s=>(p(),c("tr",{key:s.id},[t("td",_t,[t("div",kt,l(s.name),1),t("div",$t,l(s.email),1)]),t("td",Ct,[t("div",Pt,l(s.phone),1)]),t("td",St,[t("div",zt,l(s.address),1)]),t("td",jt,[t("div",It,l(s.notes),1)]),t("td",Tt,[t("button",{onClick:r=>O(s),class:"text-green-600 hover:text-green-900 flex items-center gap-1",title:"تسديد دفعة"},[_(b(it),{class:"w-4 h-4"})],8,Dt),t("button",{onClick:r=>Z(s),class:"text-indigo-600 hover:text-indigo-900 flex items-center gap-1",title:"تقرير المشتريات"},[_(b(rt),{class:"w-4 h-4"})],8,Vt),t("button",{onClick:r=>A(s),class:"text-primary-600 hover:text-primary-900 flex items-center gap-1"},[_(b(dt),{class:"w-4 h-4"})],8,Mt),t("button",{onClick:r=>Y(s.id),class:"text-red-600 hover:text-red-900 flex items-center gap-1"},[_(b(mt),{class:"w-4 h-4"})],8,Ft)])]))),128))])])]),I.value?(p(),c("div",Rt,[t("div",Ut,[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:F}),e[10]||(e[10]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),t("div",Nt,[t("div",Bt,[t("h3",Lt,l(P.value?"تعديل بيانات العميل":"إضافة عميل جديد"),1),t("div",At,[t("div",null,[t("label",qt,l(o.$t("customers.name")),1),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.value.name=s),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[g,i.value.name]])]),t("div",null,[t("label",Et,l(o.$t("customers.phone")),1),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>i.value.phone=s),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[g,i.value.phone]])]),t("div",null,[t("label",Wt,l(o.$t("customers.email")),1),h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.email=s),type:"email",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[g,i.value.email]])]),t("div",null,[t("label",Gt,l(o.$t("customers.address")),1),h(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>i.value.address=s),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},null,512),[[g,i.value.address]])]),t("div",null,[t("label",Ht,l(o.$t("customers.notes")),1),h(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>i.value.notes=s),class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",rows:"3"},null,512),[[g,i.value.notes]])])])]),t("div",Jt,[t("button",{onClick:X,type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"},l(o.$t("common.save")),1),t("button",{onClick:F,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"},l(o.$t("common.cancel")),1)])])])])):q("",!0),T.value?(p(),c("div",Kt,[t("div",Ot,[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:M}),e[15]||(e[15]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),t("div",Qt,[t("div",Xt,[e[14]||(e[14]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"}," تسديد دفعة للعميل ",-1)),t("div",Yt,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"المبلغ المدفوع",-1)),t("div",Zt,[h(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>m.value.amount=s),type:"number",class:"block w-full border border-gray-300 rounded-md shadow-sm p-2 pr-8"},null,512),[[g,m.value.amount,void 0,{number:!0}]]),e[11]||(e[11]=t("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500 sm:text-sm"},"$")],-1))])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"ملاحظات",-1)),h(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>m.value.notes=s),class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",rows:"3"},null,512),[[g,m.value.notes]])])])]),t("div",te,[t("button",{onClick:Q,type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"}," حفظ الدفعة "),t("button",{onClick:M,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"},l(o.$t("common.cancel")),1)])])])])):q("",!0),_(lt,{show:D.value,title:"كشف حساب عميل",reportTitle:B.value,subtitle:L.value,columns:K.value,data:V.value,summary:U.value,"allow-receipt":!0,onClose:e[8]||(e[8]=s=>D.value=!1),onPrintReceipt:tt},{"cell-type":R(({row:s})=>[t("span",{class:G({"px-2 py-1 rounded-full text-xs font-bold":!0,"bg-green-100 text-green-800":s.isPayment,"bg-red-100 text-red-800":s.isCredit,"bg-gray-100 text-gray-800":!s.isPayment&&!s.isCredit})},l(s.typeLabel),3)]),"cell-items":R(({row:s})=>[s.isPayment?(p(),c("div",ee,l(s.itemsText),1)):(p(),c("div",se,[(p(!0),c(E,null,W(s.rawItems,(r,x)=>(p(),c("div",{key:x,class:"mb-1 last:mb-0"}," - "+l(r.name)+" ("+l(r.quantity)+") ",1))),128))]))]),"cell-total":R(({row:s})=>[t("span",{class:G({"font-bold dir-ltr block text-left":!0,"text-green-600":s.isPayment,"text-red-600":s.isCredit,"text-gray-900":!s.isPayment&&!s.isCredit})},l(b(y)(s.totalAmount)),3)]),_:1},8,["show","reportTitle","subtitle","columns","data","summary"])]))}};export{ve as default};
